<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.7.2/animate.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.3/jquery.easing.min.js"></script>

    <title>Water-bill</title>
</head>
<body>
    <!-- The core Firebase JS SDK is always required and must be listed first -->
    <script src="/__/firebase/6.2.3/firebase-app.js"></script>

    <!-- TODO: Add SDKs for Firebase products that you want to use
     https://firebase.google.com/docs/web/setup#reserved-urls -->

    <!-- Initialize Firebase -->
    <script src="/__/firebase/init.js"></script>
    
    <img src="img/samuel-scrimshaw-ebbFZvavGy4-unsplash.jpg" id="bg" alt="">
    <div class="sidebar">
        <h1>מחשבון המים</h1>
        <h4> מחלק את חשבונית המים בין הדיירים בקלות ובחלוקה מדוייקת</h4>
        <div class="line-separator"></div>
        <nav>
            <div class="sidebar-nav">
                <div class="nav-item">הסבר</div>
                <div class="nav-item">שמור</div>
                <div class="nav-item">הגדרות</div>
            </div>
            <div class="nav-window">
               Lorem ipsum dolor sit amet consectetur adipisicing elit. Esse temporibus ipsa dem dolor sit amet consectetur adipisicing elit. Esse temporibus ipsa deserunt, veritatis ducimus magnam? Sunt consequatur voluptate minus. Dolores, iste quas mollitia sequi illum deserunt ipsum culpa repellat est!
               Lorem ipsum dolordolor sit amet consectetur adipisicing elit. Esse temporibus ipsa dem dolor sit amet consectetur adipisicing elit. Esse temporibus ipsa deserunt, veritatis ducimus magnam? Sunt consequatur voluptate minus. Dolores, iste quas mollitia sequi illum deserunt ipsum culpa repellat est!
               sit amet consectet 
               Lorem ipsum dolor sit am
               ur adipisicing elit. Esse temporibus ipsa dem dolor sit amet consectetur adipisicing elit. Esse temporibus ipsa deserunt, veritatis ducimus magnam? Sunt consequatur voluptate minus. Dolores, iste quas mollitia sequi illum deserunt ipsum culpa repellat est!
            </div>
        </nav>

    </div>
    <div class="form-container">    
        <ul id="progressbar">
            <li class="active">פרטי החשבונית</li>
            <li>צרכנים נוספים</li>
            <li>התוצאה</li>
        </ul>
        <form >
            <fieldset>
                <h2 class="fs-title">פרטי החשבונית</h2>
                <div class="fields-container">
                    <div class="main-consumer">
                        <div class="input-container">
                            <input class="family-names" type="text" data-label="name-main" placeholder="שם" value="א" required>
                            <input class="amount-of-people" type="number" data-label="people-main" placeholder="נפשות" value="3" required>
                        </div>
                        <div class="input-container">
                            <input class="prices" type="number" data-label="tariff-1" placeholder='מחיר למ"ק - תעריף 1' value="5">
                            <input class="prices" id="test" type="number" data-label="tariff-2" placeholder='מחיר למ"ק - תעריף 2' value="10">
                        </div>
                        <div class="input-container">
                            <input class="usage-amount" type="number" data-label="amount-tariff-1" placeholder="כמות מים שחויב במחיר 1" value="30">
                            <input class="usage-amount" type="number" data-label="amount-tariff-2" placeholder="כמות מים שחויב במחיר 2" value="10">
                        </div>
                    </div>
                 </div>
                <button type="button" name="next" class="next action-button first-next">הבא</button>
            </fieldset>
            <fieldset>
                <h2 class="fs-title">פרטי הצרכנים הנוספים</h2>
                <div class="fields-container">
                    <div class="secondary-consumers">
                        <div class="consumer">
                            <div class="input-container">
                                <input class="family-names" type="text" data-label="name-2" placeholder="שם" value="ב">
                                <input class="amount-of-people" type="number" data-label="people-2" placeholder="נפשות" value="5">
                            </div>
                            <div class="input-container meters">
                                <input type="number" data-label="previous-meter-reading" placeholder="קריאת מונה קודמת" value="1">
                                <input type="number" data-label="current-meter-reading" placeholder="קריאת מונה נוכחית" value="11">
                            </div>
                        </div>
                    </div>
                </div>
            <div class="add-remove-buttons">
                <button type="button" class="add-button" onclick="addConsumer()">&plus;</button>
            </div>
                <button type="button" name="previous" class="previous action-button">הקודם</button>
                <button type="button" name="next" class="next action-button" onclick="calculate()">הבא</button>
            </fieldset> 
            <fieldset id="result">
                <h2 class="fs-title">תוצאה</h2>
                <div class="fields-container">
                    <table>
                        <tr>
                            <th>שם</th>
                            <th>תעריף</th>
                            <th>צריכה</th>
                            <th>תשלום</th>
                        </tr>
                    </table>
                </div>
                <button type="button" name="previous" class="previous action-button action-button">הקודם</button>
            </fieldset>
        </form>
    </div>
    <a id="copyright" href="mailto:shayaulman@gmail.com">shayaulman@gmail.com 2019 &copy;</a>
    <!-- <div class="sidebar" id="sidebar"><div class="empty-list">Results</div></div> -->

    
    <script src="app.js"></script>

    <script>

        // # step-validation + animation  # //



        let currentFs, nextFs, previousFs; //fieldsets
        let left, opacity, scale; //fieldset properties to animate
        let animating; //flag to prevent quick multi-click glitches

        $("input").on("keyup", function (event) {
            currentFs = $(this).closest('fieldset');
         

            event.preventDefault();
            if (event.keyCode === 13) {
                console.log(currentFs);
                currentFs.find('.next').click();
            }
        });
        // var priority =  -(Math.floor(Date.now()/1000)) + -count;
        $(".next").click(function() {
            // step-validation 

            currentFs = $(this).parent();
            nextFs = $(this).parent().next();

            currentFs.find("input").filter(function() {
                $(this).val() === "" ? $(this).css("border", "1px solid red") : $(this).css("border-color", "#ccc"); 
            });
            

            let validateStep;   
            currentFs.find("input").each(function(){
                if ($(this).val() === "") {
                    validateStep = false;
                    currentFs.addClass('animated shake');
                    setTimeout(() => currentFs.removeClass('shake'), 800);
                    return false;
                }
                validateStep = true;
            });
                     
            if (!validateStep) return;
            
            if(animating) return false;
            animating = true;
            
            
            //activate next step on progressbar using the index of nextFs
            $("#progressbar li").eq($("fieldset").index(nextFs)).addClass("active");
            
            //show the next fieldset
            nextFs.show(); 
            //hide the current fieldset with style
            currentFs.animate({opacity: 0}, {
                step: function(now, mx) {
                    //as the opacity of currentFs reduces to 0 - stored in "now"
                    //1. scale currentFs down to 80%
                    scale = 1 - (1 - now) * 0.2;
                    //2. bring nextFs from the right(50%)
                    left = (now * 50)+"%";
                    //3. increase opacity of nextFs to 1 as it moves in
                    opacity = 1 - now;
                    currentFs.css({
                'transform': 'scale('+scale+')',
                'position': 'absolute'
            });
                    nextFs.css({'left': left, 'opacity': opacity});
                }, 
                duration: 800, 
                complete: function(){
                    currentFs.hide();
                    animating = false;
                }, 
                //this comes from the custom easing plugin
                easing: 'easeInOutBack'
            });
        });

        $(".previous").click(function(){
            if(animating) return false;
            animating = true;
            currentFs = $(this).parent();
            previousFs = $(this).parent().prev();
            
            //de-activate current step on progressbar
            $("#progressbar li").eq($("fieldset").index(currentFs)).removeClass("active");
            
            //show the previous fieldset
            previousFs.show(); 
            //hide the current fieldset with style
            currentFs.animate({opacity: 0}, {
                step: function(now, mx) {
                    //as the opacity of current_fs reduces to 0 - stored in "now"
                    //1. scale previousFs from 80% to 100%
                    scale = 0.8 + (1 - now) * 0.2;
                    //2. take current_fs to the right(50%) - from 0%
                    left = ((1-now) * 50)+"%";
                    //3. increase opacity of previousFs to 1 as it moves in
                    opacity = 1 - now;
                    currentFs.css({'left': left});
                    previousFs.css({'transform': 'scale('+scale+')', 'opacity': opacity});
                }, 
                duration: 800, 
                complete: function(){
                    currentFs.hide();
                    animating = false;
                }, 
                //this comes from the custom easing plugin
                easing: 'easeInOutBack'
            });
        });



    </script>

</body>
</html>